#!/bin/zsh

function colo {

    # Xresource file
    XRESOURCE=$1

    if [[ "${XRESOURCE}" == *"-dark" ]]; then
        export COLORSCHEME=${XRESOURCE%-dark}
        export BACKGROUND="dark"
        echo ${COLORSCHEME}
    elif [[ "${XRESOURCE}" == *"-light" ]]; then
        export COLORSCHEME=${XRESOURCE%-light}
        export BACKGROUND="light"
    else 
        export COLORSCHEME=${XRESOURCE}
        export BACKGROUND=""
    fi

    # Change colors for current session
    $HOME/bin/recolor < ~/.Xresources/${XRESOURCE}

    # Load Xresources file for future sessions
    xrdb -I$HOME ~/.Xresources/${XRESOURCE}

    # Change default environment variable for future sessions
    sed -i --follow-symlinks "s/^export COLORSCHEME=.*$/export COLORSCHEME=${COLORSCHEME}/g" ~/.zsh/tmp
    sed -i --follow-symlinks "s/^export BACKGROUND=.*$/export BACKGROUND=${BACKGROUND}/g" ~/.zsh/tmp
}

# Completion for colorschemes (-M -> Case insensitive)
compctl -k "($(ls ${HOME}/.Xresources))" -M 'm:{a-z}={A-Z}' colo
