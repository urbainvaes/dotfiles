#!/bin/zsh

workspaces=$(i3-msg -t get_workspaces | grep -Po '"name":.*?[^\\]"' | sed 's/"name":"\([^"]\+\)"/\1/g')

if [[ ! -z $1 ]]; then
    target=$(echo $workspaces | grep "$1")
    [[ -z $target ]] && target=$1
else
    used_numbers=$(echo $workspaces | awk 'BEGIN { FS = ":" } ; { print $1 }')
    max_number=$(echo $used_numbers | tail -1)
    lowest_gap=$(echo $used_numbers | awk '$1!=p+1{print p+1}{p=$1}' | head -1)
    [[ -z $lowest_gap ]] && new_number=$(($max_number +  1)) || new_number=$lowest_gap

    target=$(echo $workspaces | dmenu -i -sf green -p "Go to workspace:")
    [[ -z $target ]] && exit
    [[ ! $target = [0-9]* ]] && target=$new_number:$target
fi

echo $target
